<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 다른 mapper와 중복되지 않도록 네임스페이스 기재 -->
<!-- mapper - mybatis, sqlMap - ibatis -->
<mapper namespace="review">
  	
  	<!-- 리뷰 목록 조회 -->
	<select id="reviewList" resultType="com.shopping.dto.ReviewDTO">
	    SELECT 
	        R.RNO,
	        R.REVIEW_TITLE,
	        R.REVIEW_CONTENT,
	        M1.MEM_NAME,
	        M1.MEM_ID AS MEM_ID,
	        P.PROD_NO,
	        P.PROD_NAME,
	        R.PROD_IMAGE,
	        M2.MEM_ID AS REPLY_ID,
	        R.REPLY,
	        R.REG_DATE,
	        R.DEL_DATE
	    FROM 
	        REVIEW R
	    LEFT JOIN 
	        PRODUCT P ON R.PROD_NO = P.PROD_NO
	    LEFT JOIN 
	        MEMBER M1 ON R.MEM_ID = M1.MEM_ID
	    LEFT JOIN 
	        MEMBER M2 ON R.REPLY_ID = M2.MEM_ID;
	</select>

	<!-- 리뷰 등록 -->
	<insert id="insertProduct" parameterType="com.shopping.dto.ProductDTO">
	    INSERT INTO PRODUCT
		    (PROD_NAME,
		     PROD_KIND,
		     PRICE,
		     CATE_NO,
		     PROD_CONTENT,
		     PROD_IMAGE,
		     USEYN,
		     REGDATE,
		     DELDATE)
		VALUES (
		    #{prod_name},
		    #{prod_kind},
		    #{price},
		    #{cate_no},
		    #{prod_content},
		    #{prod_image},
		    'Y',
		    DATE_FORMAT(NOW(), '%Y%m%d%H%i%s'),
		    NULL
		)
	</insert>
	
	
</mapper> 