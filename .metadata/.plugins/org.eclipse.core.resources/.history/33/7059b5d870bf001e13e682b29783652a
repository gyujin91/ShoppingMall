<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 다른 mapper와 중복되지 않도록 네임스페이스 기재 -->
<!-- mapper - mybatis, sqlMap - ibatis -->
<mapper namespace="cart">
  	
  	<!-- 장바구니 담기-->
  	<insert id="addToCart" parameterType="com.shopping.dto.CartDTO">
  		INSERT INTO CART
  		(			
  		MEM_ID,				<!-- 사용자 아이디(FK) -->
  		PROD_NO,			<!-- 상품 고유 번호(FK) -->
  		PROD_NAME,			<!-- 상품명 -->
  		PRICE,				<!-- 상품 가격 -->
  		QUANTITY,			<!-- 상품 수량 -->
  		PROD_IMG,			<!-- 상품 이미지 -->
  		CREATED_DATE		<!-- 장비구나 생성일 -->
  		) VALUES (
  		#{mem_id},
  		#{prod_no},
  		#{prod_name},
  		#{price},
  		#{quantity},
  		#{prod_img},
  		DATE_FORMAT(NOW(), '%Y%m%d%H%i%s'))
  	</insert>

    <!-- 장바구니 목록 조회 -->
    <select id="cartList" resultType="com.shopping.dto.CartDTO">
        SELECT
            C.CART_ID,
            M.MEM_ID,
            P.PROD_NO,
            P.PROD_NAME,
            C.QUANTITY,
            P.PROD_IMAGE,
            C.CREATED_DATE,
            P.PRICE,
            (P.PRICE * C.QUANTITY) AS MONEY
        FROM
            MEMBER M, PRODUCT P, CART C
        WHERE
            M.MEM_ID = C.MEM_ID
            AND P.PROD_NO = C.PROD_NO
            AND C.MEM_ID = #{mem_id}
        ORDER BY
            C.CART_ID;
    </select>
  	
  	<!-- 장바구니 상품 총 수량 -->
  	<select id="totalQuantity" resultType="Integer">
  		<![CDATA[
  		SELECT 
  			SUM(QUANTITY) AS TOTAL_QUANTITY
  		FROM CART
  		WHERE MEM_ID = #{mem_id}
		]]>
  	</select>
  	
  	<!-- 장바구니 상품 삭제 -->
	<delete id="cartDelete">
		DELTE FROM CART
		WHERE CART_ID = #{cart_id}
	</delete>
	
	<select id="">
		<![CDATA[
		SELECT 
		    SUM(QUANTITY) AS TOTAL_QUANTITY,
		    SUM(PRICE) AS TOTAL_PRICE,
		    MEM_ID
		FROM  CART
		GROUP BY MEM_ID;
		]]>
	</select>
</mapper> 